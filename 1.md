# `csv`, `pandas` та візуалізація з `matplotlib`

Під час аналізу даних ми зазвичай проходимо три етапи: зчитування (імпорт), обробка (аналіз) та візуалізація (презентація результатів). Для кожного з цих етапів існують свої найкращі інструменти.

---

## 1. Модуль `csv`: Базова робота з файлами

Вбудована бібліотека `csv` ідеально підходить для простих завдань, коли не хочеться встановлювати додаткові пакети.

### Читання через `csv.reader` (за індексами)

Це найпростіший спосіб. Дані зчитуються як списки, і до колонок треба звертатися за їхнім порядковим номером (наприклад, `row[4]`).

```python
import csv

with open('titanic.csv', mode='r', encoding='utf-8') as file:
    reader = csv.reader(file)
    header = next(reader) # Зчитуємо перший рядок (заголовки)
    for row in reader:
        # row[0] - Ім'я, row[4] - Вижив/не вижив
        pass

```

### Читання через `csv.DictReader` (за назвами колонок)

Це **набагато зручніший** підхід. `DictReader` автоматично використовує перший рядок як ключі для словника. Вам не потрібно пам'ятати індекси колонок!

```python
import csv

with open('titanic.csv', mode='r', encoding='utf-8') as file:
    reader = csv.DictReader(file)
    survived_count = 0
    total_count = 0
    
    for row in reader:
        total_count += 1
        # Звертаємось до даних за назвою колонки
        if row['Survived'] == '1':
            survived_count += 1

    print(f"Вижило: {survived_count} з {total_count}")

```

---

## 2. Бібліотека `pandas`: Професійна аналітика

`Pandas` — це швейцарський ніж для дата-аналітика. Основна структура даних тут — **DataFrame** (двовимірна таблиця, схожа на аркуш Excel).

### Базове дослідження даних (EDA)

Перед тим як аналізувати дані, їх потрібно "відчути" та перевірити на наявність помилок чи пропусків.

```python
import pandas as pd

# Зчитування файлу
df = pd.read_csv("titanic.csv")

# 1. Швидкий погляд на дані
print(df.head(5))       # Виводить перші 5 рядків
print(df.info())        # Показує типи даних та кількість непорожніх значень
print(df.describe())    # Базова статистика (середнє, мін, макс) для числових колонок

# 2. Перевірка на пропущені значення (NaN)
print(df.isnull().sum()) 

# 3. Очищення даних
# Якщо в колонці 'Age' (Вік) є пропуски, ми можемо заповнити їх медіанним віком:
median_age = df['Age'].median()
df['Age'] = df['Age'].fillna(median_age)

```

### Фільтрація та Агрегація

Pandas дозволяє фільтрувати дані так само легко, як в SQL.

```python
# Відбираємо тільки жінок з 1-го класу
rich_women = df[(df['Sex'] == 'female') & (df['PClass'] == '1st')]

# Групування: Середній вік пасажирів по класах
avg_age_by_class = df.groupby('PClass')['Age'].mean()
print(avg_age_by_class)

# Зведена таблиця (Pivot Table): Виживання за статтю та класом
pivot = pd.pivot_table(df, values='Survived', index='Sex', columns='PClass', aggfunc='mean')
print(pivot)

```

---

## 3. Бібліотека `Matplotlib`: Створення графіків

Цифри в таблицях важко сприймати візуально. `Matplotlib` (зокрема модуль `pyplot`) дозволяє перетворити дані Pandas на зрозумілі графіки.

### Встановлення

Якщо бібліотека не встановлена: `pip install matplotlib`

### Побудова основних типів графіків на базі Титаніка

```python
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv("titanic.csv")

# Налаштування стилю (опціонально)
plt.style.use('seaborn-v0_8-darkgrid')

# ==========================================
# 1. Стовпчаста діаграма (Bar Chart)
# Покажемо кількість пасажирів у кожному класі
# ==========================================
class_counts = df['PClass'].value_counts().sort_index()

plt.figure(figsize=(8, 5)) # Розмір графіка
class_counts.plot(kind='bar', color=['#1f77b4', '#ff7f0e', '#2ca02c'])
plt.title('Кількість пасажирів за класами')
plt.xlabel('Клас квитка')
plt.ylabel('Кількість людей')
plt.xticks(rotation=0) # Щоб підписи по осі X були горизонтальними
plt.show() # Відобразити графік

# ==========================================
# 2. Гістограма (Histogram)
# Розподіл віку пасажирів (скільки людей якого віку)
# ==========================================
plt.figure(figsize=(8, 5))
plt.hist(df['Age'].dropna(), bins=20, color='skyblue', edgecolor='black')
plt.title('Розподіл пасажирів за віком')
plt.xlabel('Вік (роки)')
plt.ylabel('Частота')
plt.show()

# ==========================================
# 3. Кругова діаграма (Pie Chart)
# Співвідношення чоловіків та жінок
# ==========================================
gender_counts = df['Sex'].value_counts()

plt.figure(figsize=(6, 6))
plt.pie(gender_counts, labels=gender_counts.index, autopct='%1.1f%%', 
        startangle=90, colors=['lightblue', 'pink'])
plt.title('Співвідношення статей на Титаніку')
plt.show()

```

### Як це працює разом (Pandas + Matplotlib)

Найчастіше ви спочатку обробляєте дані за допомогою `pandas`, а потім одразу викликаєте метод `.plot()` для результату:

```python
# Побудова графіка виживання за класом в один рядок
df.groupby('PClass')['Survived'].mean().plot(kind='bar', color='green', title='Відсоток виживання за класом')
plt.ylabel('Відсоток виживання')
plt.show()

```
* Використовуйте `csv.DictReader` для простих скриптів без залежностей.
* Переходьте на `pandas` (`read_csv`, `groupby`, `fillna`), коли даних багато і потрібна складна математика або фільтрація.
* Використовуйте `matplotlib.pyplot`, щоб довести свої висновки візуально. Графік сприймається керівництвом або клієнтами на 90% краще, ніж "голі" цифри.
